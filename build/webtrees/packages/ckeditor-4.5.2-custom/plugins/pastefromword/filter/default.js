(function(){function d(p){p=p.toUpperCase();for(var t=c.length,o=0,q=0;q<t;++q){for(var s=c[q],r=s[1].length;p.substr(0,r)==s[1];p=p.substr(r)){o+=s[0]}}return o}function a(p){p=p.toUpperCase();for(var r=n.length,o=1,q=1;0<p.length;q*=r){o+=n.indexOf(p.charAt(p.length-1))*q,p=p.substr(0,p.length-1)}return o}var m=CKEDITOR.htmlParser.fragment.prototype,b=CKEDITOR.htmlParser.element.prototype;m.onlyChild=b.onlyChild=function(){var o=this.children;return 1==o.length&&o[0]||null};b.removeAnyChildWithName=function(p){for(var s=this.children,o=[],q,r=0;r<s.length;r++){q=s[r],q.name&&(q.name==p&&(o.push(q),s.splice(r--,1)),o=o.concat(q.removeAnyChildWithName(p)))}return o};b.getAncestor=function(o){for(var p=this.parent;p&&(!p.name||!p.name.match(o));){p=p.parent}return p};m.firstChild=b.firstChild=function(p){for(var q,o=0;o<this.children.length;o++){if(q=this.children[o],p(q)||q.name&&(q=q.firstChild(p))){return q}}return null};b.addStyle=function(p,s,o){var q="";if("string"==typeof s){q+=p+":"+s+";"}else{if("object"==typeof p){for(var r in p){p.hasOwnProperty(r)&&(q+=r+":"+p[r]+";")}}else{q+=p}o=s}this.attributes||(this.attributes={});p=this.attributes.style||"";p=(o?[q,p]:[p,q]).join(";");this.attributes.style=p.replace(/^;+|;(?=;)/g,"")};b.getStyle=function(o){var p=this.attributes.style;if(p){return p=CKEDITOR.tools.parseCssText(p,1),p[o]}};CKEDITOR.dtd.parentOf=function(p){var q={},o;for(o in this){-1==o.indexOf("$")&&this[o][p]&&(q[o]=1)}return q};var g=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,l=/^(?:\b0[^\s]*\s*){1,4}$/,e={ol:{decimal:/\d+/,"lower-roman":/^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$/,"upper-roman":/^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},ul:{disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/}},c=[[1000,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],n="ABCDEFGHIJKLMNOPQRSTUVWXYZ",k=0,i=null,f,j=CKEDITOR.plugins.pastefromword={utils:{createListBulletMarker:function(p,q){var o=new CKEDITOR.htmlParser.element("cke:listbullet");o.attributes={"cke:listsymbol":p[0]};o.add(new CKEDITOR.htmlParser.text(q));return o},isListBulletIndicator:function(o){if(/mso-list\s*:\s*Ignore/i.test(o.attributes&&o.attributes.style)){return !0}},isContainingOnlySpaces:function(o){var p;return(p=o.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(p.value)},resolveList:function(p){var q=p.attributes,o;if((o=p.removeAnyChildWithName("cke:listbullet"))&&o.length&&(o=o[0])){return p.name="cke:li",q.style&&(q.style=j.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(r){r=r.split(" ");r=CKEDITOR.tools.convertToPx(r[3]||r[1]||r[0]);!k&&null!==i&&r>i&&(k=r-i);i=r;q["cke:indent"]=k&&Math.ceil(r/k)+1||1}],[/^mso-list$/,null,function(s){s=s.split(" ");if(!(2>s.length)){var r=Number(s[0].match(/\d+/));s=Number(s[1].match(/\d+/));1==s&&(r!==f&&(q["cke:reset"]=1),f=r);q["cke:indent"]=s}}]])(q.style,p)||""),q["cke:indent"]||(i=0,q["cke:indent"]=1),CKEDITOR.tools.extend(q,o.attributes),!0}f=i=k=null;return !1},getStyleComponents:function(){var o=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);CKEDITOR.document.getBody().append(o);return function(s,p,q){o.setStyle(s,p);s={};p=q.length;for(var r=0;r<p;r++){s[q[r]]=o.getStyle(q[r])}return s}}(),listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(y,w){w="number"==typeof w?w:1;var x=y.attributes,t;switch(x.type){case"a":t="lower-alpha";break;case"1":t="decimal"}for(var v=y.children,u,q=0;q<v.length;q++){if(u=v[q],u.name in CKEDITOR.dtd.$listItem){var p=u.attributes,s=u.children,o=s[0],r=s[s.length-1];o.attributes&&o.attributes.style&&-1<o.attributes.style.indexOf("mso-list")&&(u.attributes.style=o.attributes.style,o.replaceWithChildren());r.name in CKEDITOR.dtd.$list&&(y.add(r,q+1),--s.length||v.splice(q--,1));u.name="cke:li";x.start&&!q&&(p.value=x.start);j.filters.stylesFilter([["tab-stops",null,function(z){(z=z.split(" ")[1].match(g))&&(i=CKEDITOR.tools.convertToPx(z[0]))}],1==w?["mso-list",null,function(z){z=z.split(" ");z=Number(z[0].match(/\d+/));z!==f&&(p["cke:reset"]=1);f=z}]:null])(p.style);p["cke:indent"]=w;p["cke:listtype"]=y.name;p["cke:list-style-type"]=t}else{if(u.name in CKEDITOR.dtd.$list){arguments.callee.apply(this,[u,w+1]);v=v.slice(0,q).concat(u.children).concat(v.slice(q+1));y.children=[];u=0;for(s=v.length;u<s;u++){y.add(v[u])}v=y.children}}}delete y.name;x["cke:list"]=1},assembleList:function(L){var J=L.children,K,G,I,H,D,C;L=[];for(var F,A,E,z,B,w,y=0;y<J.length;y++){if(K=J[y],"cke:li"==K.name){if(K.name="li",G=K.attributes,E=(E=G["cke:listsymbol"])&&E.match(/^(?:[(]?)([^\s]+?)([.)]?)$/),z=B=w=null,G["cke:ignored"]){J.splice(y--,1)}else{G["cke:reset"]&&(C=H=D=null);I=Number(G["cke:indent"]);I!=H&&(A=F=null);if(E){if(A&&e[A][F].test(E[1])){z=A,B=F}else{for(var v in e){for(var o in e[v]){if(e[v][o].test(E[1])){if("ol"==v&&/alpha|roman/.test(o)){if(F=/roman/.test(o)?d(E[1]):a(E[1]),!w||F<w){w=F,z=v,B=o}}else{z=v;B=o;break}}}}}!z&&(z=E[2]?"ol":"ul")}else{z=G["cke:listtype"]||"ol",B=G["cke:list-style-type"]}A=z;F=B||("ol"==z?"decimal":"disc");B&&B!=("ol"==z?"decimal":"disc")&&K.addStyle("list-style-type",B);if("ol"==z&&E){switch(B){case"decimal":w=Number(E[1]);break;case"lower-roman":case"upper-roman":w=d(E[1]);break;case"lower-alpha":case"upper-alpha":w=a(E[1])}K.attributes.value=w}if(C){if(I>H){L.push(C=new CKEDITOR.htmlParser.element(z)),C.add(K),D.add(C)}else{if(I<H){H-=I;for(var r;H--&&(r=C.parent);){C=r.parent}}C.add(K)}J.splice(y--,1)}else{L.push(C=new CKEDITOR.htmlParser.element(z)),C.add(K),J[y]=C}D=K;H=I}}else{C&&(C=H=D=null)}}for(y=0;y<L.length;y++){if(C=L[y],v=C.children,F=F=void 0,o=C.children.length,r=F=void 0,J=/list-style-type:(.*?)(?:;|$)/,H=CKEDITOR.plugins.pastefromword.filters.stylesFilter,F=C.attributes,!J.exec(F.style)){for(D=0;D<o;D++){if(F=v[D],F.attributes.value&&Number(F.attributes.value)==D+1&&delete F.attributes.value,F=J.exec(F.attributes.style)){if(F[1]!=r&&r){r=null;break}else{r=F[1]}}}if(r){for(D=0;D<o;D++){F=v[D].attributes,F.style&&(F.style=H([["list-style-type"]])(F.style)||"")}C.addStyle("list-style-type",r)}}}f=i=k=null},falsyFilter:function(){return !1},stylesFilter:function(o,p){return function(q,r){var t=[];(q||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(v,z,x){z=z.toLowerCase();"font-family"==z&&(x=x.replace(/["']/g,""));for(var A,w,y,u=0;u<o.length;u++){if(o[u]&&(v=o[u][0],A=o[u][1],w=o[u][2],y=o[u][3],z.match(v)&&(!A||x.match(A)))){z=y||z;p&&(w=w||x);"function"==typeof w&&(w=w(x,r,z));w&&w.push&&(z=w[0],w=w[1]);"string"==typeof w&&t.push([z,w]);return}}!p&&t.push([z,x])});for(var s=0;s<t.length;s++){t[s]=t[s].join(":")}return t.length?t.join(";")+";":!1}},elementMigrateFilter:function(o,p){return o?function(q){var r=p?(new CKEDITOR.style(o,p))._.definition:o;q.name=r.element;CKEDITOR.tools.extend(q.attributes,CKEDITOR.tools.clone(r.attributes));q.addStyle(CKEDITOR.style.getStyleText(r));r.attributes&&r.attributes["class"]&&(q.classWhiteList=" "+r.attributes["class"]+" ")}:function(){}},styleMigrateFilter:function(p,q){var o=this.elementMigrateFilter;return p?function(s,u){var t=new CKEDITOR.htmlParser.element(null),r={};r[q]=s;o(p,r)(t);t.children=u.children;u.children=[t];t.filter=function(){};t.parent=u}:function(){}},bogusAttrFilter:function(o,p){if(-1==p.name.indexOf("cke:")){return !1}},applyStyleFilter:null},getRules:function(R,P){var Q=CKEDITOR.dtd,M=CKEDITOR.tools.extend({},Q.$block,Q.$listItem,Q.$tableContent),O=R.config,N=this.filters,J=N.falsyFilter,I=N.stylesFilter,L=N.elementMigrateFilter,G=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),K=this.utils.createListBulletMarker,F=N.flattenList,H=N.assembleList,C=this.utils.isListBulletIndicator,E=this.utils.isContainingOnlySpaces,B=this.utils.resolveList,o=function(p){p=CKEDITOR.tools.convertToPx(p);return isNaN(p)?p:p+"px"},A=this.utils.getStyleComponents,y=this.utils.listDtdParents,D=!1!==O.pasteFromWordRemoveFontStyles,z=!1!==O.pasteFromWordRemoveStyles;return{elementNames:[[/meta|link|script/,""]],root:function(p){p.filterChildren(P);H(p)},elements:{"^":function(p){var q;CKEDITOR.env.gecko&&(q=N.applyStyleFilter)&&q(p)},$:function(p){var r=p.name||"",q=p.attributes;r in M&&q.style&&(q.style=I([[/^(:?width|height)$/,null,o]])(q.style)||"");if(r.match(/h\d/)){p.filterChildren(P);if(B(p)){return}L(O["format_"+r])(p)}else{if(r in Q.$inline){p.filterChildren(P),E(p)&&delete p.name}else{if(-1!=r.indexOf(":")&&-1==r.indexOf("cke")){p.filterChildren(P);if("v:imagedata"==r){if(r=p.attributes["o:href"]){p.attributes.src=r}p.name="img";return}delete p.name}}}r in y&&(p.filterChildren(P),H(p))},style:function(p){if(CKEDITOR.env.gecko){p=(p=p.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/))&&p[1];var q={};p&&(p.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(s,r,t){r=r.split(",");s=r.length;for(var u=0;u<s;u++){CKEDITOR.tools.trim(r[u]).replace(/^(\w+)(\.[\w-]+)?$/g,function(w,v,x){v=v||"*";x=x.substring(1,x.length);x.match(/MsoNormal/)||(q[v]||(q[v]={}),x?q[v][x]=t:q[v]=t)})}}),N.applyStyleFilter=function(s){var r=q["*"]?"*":s.name,t=s.attributes&&s.attributes["class"];r in q&&(r=q[r],"object"==typeof r&&(r=r[t]),r&&s.addStyle(r,!0))})}return !1},p:function(q){if(/MsoListParagraph/i.exec(q.attributes["class"])||q.getStyle("mso-list")){var p=q.firstChild(function(r){return r.type==CKEDITOR.NODE_TEXT&&!E(r.parent)});(p=p&&p.parent)&&p.addStyle("mso-list","Ignore")}q.filterChildren(P);B(q)||(O.enterMode==CKEDITOR.ENTER_BR?(delete q.name,q.add(new CKEDITOR.htmlParser.element("br"))):L(O["format_"+(O.enterMode==CKEDITOR.ENTER_P?"p":"div")])(q))},div:function(q){var r=q.onlyChild();if(r&&"table"==r.name){var p=q.attributes;r.attributes=CKEDITOR.tools.extend(r.attributes,p);p.style&&r.addStyle(p.style);r=new CKEDITOR.htmlParser.element("div");r.addStyle("clear","both");q.add(r);delete q.name}},td:function(p){p.getAncestor("thead")&&(p.name="th")},ol:F,ul:F,dl:F,font:function(q){if(C(q.parent)){delete q.name}else{q.filterChildren(P);var p=q.attributes,s=p.style,r=q.parent;"font"==r.name?(CKEDITOR.tools.extend(r.attributes,q.attributes),s&&r.addStyle(s),delete q.name):(s=(s||"").split(";"),p.color&&("#000000"!=p.color&&s.push("color:"+p.color),delete p.color),p.face&&(s.push("font-family:"+p.face),delete p.face),p.size&&(s.push("font-size:"+(3<p.size?"large":3>p.size?"small":"medium")),delete p.size),q.name="span",q.addStyle(s.join(";")))}},span:function(q){if(C(q.parent)){return !1}q.filterChildren(P);if(E(q)){return delete q.name,null}if(C(q)){var p=q.firstChild(function(s){return s.value||"img"==s.name}),r=(p=p&&(p.value||"l."))&&p.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(r){return p=K(r,p),(q=q.getAncestor("span"))&&/ mso-hide:\s*all|display:\s*none /.test(q.attributes.style)&&(p.attributes["cke:ignored"]=1),p}}if(r=(p=q.attributes)&&p.style){p.style=I([["line-height"],[/^font-family$/,null,D?null:G(O.font_style,"family")],[/^font-size$/,null,D?null:G(O.fontSize_style,"size")],[/^color$/,null,D?null:G(O.colorButton_foreStyle,"color")],[/^background-color$/,null,D?null:G(O.colorButton_backStyle,"color")]])(r,q)||""}p.style||delete p.style;CKEDITOR.tools.isEmpty(p)&&delete q.name;return null},b:L(O.coreStyles_bold),i:L(O.coreStyles_italic),u:L(O.coreStyles_underline),s:L(O.coreStyles_strike),sup:L(O.coreStyles_superscript),sub:L(O.coreStyles_subscript),a:function(p){p=p.attributes;p.href&&p.href.match(/^file:\/\/\/[\S]+#/i)&&(p.href=p.href.replace(/^file:\/\/\/[^#]+/i,""))},"cke:listbullet":function(p){p.getAncestor(/h\d/)&&!O.pasteFromWordNumberedHeadingToList&&delete p.name}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:I(z?[[/^list-style-type$/,null],[/^margin$|^margin-(?!bottom|top)/,null,function(q,p,r){if(p.name in {p:1,div:1}){p="ltr"==O.contentsLangDirection?"margin-left":"margin-right";if("margin"==r){q=A(r,q,[p])[p]}else{if(r!=p){return null}}if(q&&!l.test(q)){return[p,q]}}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(q,p){if("img"==p.name){return q}}],[/^width|height$/,null,function(q,p){if(p.name in {table:1,td:1,th:1,img:1}){return q}}]]:[[/^mso-/],[/-color$/,null,function(p){if("transparent"==p){return !1}if(CKEDITOR.env.gecko){return p.replace(/-moz-use-text-color/g,"transparent")}}],[/^margin$/,l],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],D?[/font-?/]:null],z),width:function(p,q){if(q.name in Q.$tableContent){return !1}},border:function(p,q){if(q.name in Q.$tableContent){return !1}},"class":function(q,p){return p.classWhiteList&&-1!=p.classWhiteList.indexOf(" "+q+" ")?q:!1},bgcolor:J,valign:z?J:function(q,p){p.addStyle("vertical-align",q);return !1}},comment:CKEDITOR.env.ie?J:function(q,p){var s=q.match(/<img.*?>/),r=q.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);return r?(r=(s=r[1]||s&&"l.")&&s.match(/>(?:[(]?)([^\s]+?)([.)]?)</),K(r,s)):CKEDITOR.env.gecko&&s?(s=CKEDITOR.htmlParser.fragment.fromHtml(s[0]).children[0],(r=(r=(r=p.previous)&&r.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/))&&r[1])&&(s.attributes.src=r),s):!1}}}},h=function(){this.dataFilter=new CKEDITOR.htmlParser.filter};h.prototype={toHtml:function(o){o=CKEDITOR.htmlParser.fragment.fromHtml(o);var p=new CKEDITOR.htmlParser.basicWriter;o.writeHtml(p,this.dataFilter);return p.getHtml(!0)}};CKEDITOR.cleanWord=function(p,s){p=p.replace(/<!\[([^\]]*?)\]>/g,"\x3c!--[$1]--\x3e");CKEDITOR.env.gecko&&(p=p.replace(/(<\!--\[if[^<]*?\])--\>([\S\s]*?)<\!--(\[endif\]--\>)/gi,"$1$2$3"));CKEDITOR.env.webkit&&(p=p.replace(/(class="MsoListParagraph[^>]+><\!--\[if !supportLists\]--\>)([^<]+<span[^<]+<\/span>)(<\!--\[endif\]--\>)/gi,"$1<span>$2</span>$3"));var o=new h,q=o.dataFilter;q.addRules(CKEDITOR.plugins.pastefromword.getRules(s,q));s.fire("beforeCleanWord",{filter:q});try{p=o.toHtml(p)}catch(r){s.showNotification(s.lang.pastefromword.error)}p=p.replace(/cke:.*?".*?"/g,"");p=p.replace(/style=""/g,"");return p.replace(/<span>/g,"")}})();